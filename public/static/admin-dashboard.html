<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kwikr Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'kwikr-green': '#00C881',
              'kwikr-dark': '#1a1a1a',
              'kwikr-gray': '#f8f9fa'
            }
          }
        }
      }
    </script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Navigation Header -->
    <nav class="bg-white shadow-lg border-b-2 border-kwikr-green">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <img src="/static/kwikr-logo.svg" alt="Kwikr" class="h-10 w-10 mr-3">
                    <h1 class="text-2xl font-bold text-kwikr-green">Kwikr Admin</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="adminUserInfo" class="text-gray-700 font-medium">Loading...</span>
                    <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Dashboard Tabs -->
        <div class="mb-8">
            <div class="flex flex-wrap border-b border-gray-200">
                <button class="tab-button active" onclick="showSection('overview')" data-section="overview">
                    <i class="fas fa-tachometer-alt mr-2"></i>Overview
                </button>
                <button class="tab-button" onclick="showSection('admin-panel')" data-section="admin-panel">
                    <i class="fas fa-users-cog mr-2"></i>Admin Panel & Management
                </button>
                <button class="tab-button" onclick="showSection('analytics')" data-section="analytics">
                    <i class="fas fa-chart-bar mr-2"></i>Analytics & Reporting
                </button>
                <button class="tab-button" onclick="showSection('marketing')" data-section="marketing">
                    <i class="fas fa-bullhorn mr-2"></i>Marketing & Growth
                </button>
                <button class="tab-button" onclick="showSection('feature-flags')" data-section="feature-flags">
                    <i class="fas fa-toggle-on mr-2"></i>Feature Flags
                </button>
                <button class="tab-button" onclick="showSection('compliance')" data-section="compliance">
                    <i class="fas fa-shield-alt mr-2"></i>Compliance & Security
                </button>
                <button class="tab-button" onclick="showSection('api-docs')" data-section="api-docs">
                    <i class="fas fa-code mr-2"></i>API Documentation
                </button>
            </div>
        </div>

        <!-- Dashboard Overview Section -->
        <div id="overview-section" class="dashboard-section">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Platform Overview</h2>
            
            <!-- Key Metrics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-blue-500">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100 text-blue-500">
                            <i class="fas fa-users text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Active Users</p>
                            <p id="activeUsers" class="text-2xl font-bold text-gray-900">Loading...</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-green-500">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-green-100 text-green-500">
                            <i class="fas fa-briefcase text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Total Jobs</p>
                            <p id="totalJobs" class="text-2xl font-bold text-gray-900">Loading...</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-yellow-500">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-yellow-100 text-yellow-500">
                            <i class="fas fa-dollar-sign text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Revenue Today</p>
                            <p id="revenueToday" class="text-2xl font-bold text-gray-900">Loading...</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-red-500">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-red-100 text-red-500">
                            <i class="fas fa-exclamation-triangle text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Error Rate</p>
                            <p id="errorRate" class="text-2xl font-bold text-gray-900">Loading...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">User Activity</h3>
                    <canvas id="userActivityChart" width="400" height="200"></canvas>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Revenue Trend</h3>
                    <canvas id="revenueChart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Recent Activities -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Recent Admin Activities</h3>
                <div id="recentActivities" class="space-y-3">
                    <!-- Activities will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Admin Panel & Management Section -->
        <div id="admin-panel-section" class="dashboard-section" style="display: none;">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Admin Panel & Management</h2>
            
            <!-- Platform Overview Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-blue-50 rounded-lg p-6 border-l-4 border-blue-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-blue-600">Total Users</p>
                            <p id="totalPlatformUsers" class="text-2xl font-bold text-blue-900">Loading...</p>
                        </div>
                        <i class="fas fa-users text-blue-500 text-2xl"></i>
                    </div>
                </div>
                <div class="bg-green-50 rounded-lg p-6 border-l-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-green-600">Active Jobs</p>
                            <p id="totalActiveJobs" class="text-2xl font-bold text-green-900">Loading...</p>
                        </div>
                        <i class="fas fa-briefcase text-green-500 text-2xl"></i>
                    </div>
                </div>
                <div class="bg-purple-50 rounded-lg p-6 border-l-4 border-purple-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-purple-600">Workers</p>
                            <p id="totalWorkers" class="text-2xl font-bold text-purple-900">Loading...</p>
                        </div>
                        <i class="fas fa-hammer text-purple-500 text-2xl"></i>
                    </div>
                </div>
                <div class="bg-orange-50 rounded-lg p-6 border-l-4 border-orange-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-orange-600">Clients</p>
                            <p id="totalClients" class="text-2xl font-bold text-orange-900">Loading...</p>
                        </div>
                        <i class="fas fa-building text-orange-500 text-2xl"></i>
                    </div>
                </div>
            </div>

            <!-- Management Tabs -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <div class="flex flex-wrap border-b border-gray-200 mb-6">
                    <button class="management-tab-button active" onclick="showManagementTab('platform-users')" data-tab="platform-users">
                        <i class="fas fa-users mr-2"></i>Platform Users
                    </button>
                    <button class="management-tab-button" onclick="showManagementTab('job-management')" data-tab="job-management">
                        <i class="fas fa-briefcase mr-2"></i>Job Management
                    </button>
                    <button class="management-tab-button" onclick="showManagementTab('admin-users')" data-tab="admin-users">
                        <i class="fas fa-user-shield mr-2"></i>Admin Users
                    </button>
                    <button class="management-tab-button" onclick="showManagementTab('content-moderation')" data-tab="content-moderation">
                        <i class="fas fa-flag mr-2"></i>Content Moderation
                    </button>
                </div>

                <!-- Platform Users Tab -->
                <div id="platform-users-tab" class="management-tab-content">
                    <div class="flex flex-col lg:flex-row gap-6 mb-6">
                        <div class="flex-1">
                            <input type="text" id="userSearchInput" placeholder="Search users by name, email, or phone..." 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-kwikr-green focus:border-transparent"
                                   onkeyup="searchUsers()">
                        </div>
                        <div class="flex gap-3">
                            <select id="userRoleFilter" onchange="filterUsers()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-kwikr-green">
                                <option value="">All Roles</option>
                                <option value="client">Clients</option>
                                <option value="worker">Workers</option>
                                <option value="admin">Admins</option>
                            </select>
                            <select id="userStatusFilter" onchange="filterUsers()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-kwikr-green">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                            <button onclick="loadPlatformUsers()" class="bg-kwikr-green text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">
                                <i class="fas fa-sync mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                    <div id="platformUsersTable" class="overflow-x-auto">
                        <!-- Platform users table will be loaded here -->
                    </div>
                </div>

                <!-- Job Management Tab -->
                <div id="job-management-tab" class="management-tab-content" style="display: none;">
                    <div class="flex flex-col lg:flex-row gap-6 mb-6">
                        <div class="flex-1">
                            <input type="text" id="jobSearchInput" placeholder="Search jobs by title, description, or location..." 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-kwikr-green focus:border-transparent"
                                   onkeyup="searchJobs()">
                        </div>
                        <div class="flex gap-3">
                            <select id="jobStatusFilter" onchange="filterJobs()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-kwikr-green">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="in_progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                            <button onclick="loadPlatformJobs()" class="bg-kwikr-green text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">
                                <i class="fas fa-sync mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                    <div id="platformJobsTable" class="overflow-x-auto">
                        <!-- Platform jobs table will be loaded here -->
                    </div>
                </div>

                <!-- Admin Users Tab -->
                <div id="admin-users-tab" class="management-tab-content" style="display: none;">
                    <div class="space-y-4">
                        <div class="flex gap-4">
                            <button onclick="loadAdminUsers()" class="bg-kwikr-green text-white py-2 px-6 rounded-lg hover:bg-green-600 transition-colors">
                                <i class="fas fa-list mr-2"></i>View Admin Users
                            </button>
                            <button onclick="showCreateAdminForm()" class="bg-blue-500 text-white py-2 px-6 rounded-lg hover:bg-blue-600 transition-colors">
                                <i class="fas fa-user-plus mr-2"></i>Create Admin User
                            </button>
                            <button onclick="showRoleManagement()" class="bg-purple-500 text-white py-2 px-6 rounded-lg hover:bg-purple-600 transition-colors">
                                <i class="fas fa-user-shield mr-2"></i>Manage Roles
                            </button>
                        </div>
                        <div id="adminUsersTable">
                            <!-- Admin users table will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Content Moderation Tab -->
                <div id="content-moderation-tab" class="management-tab-content" style="display: none;">
                    <div class="space-y-4">
                        <div class="flex gap-4">
                            <button onclick="loadModerationQueue()" class="bg-orange-500 text-white py-2 px-6 rounded-lg hover:bg-orange-600 transition-colors">
                                <i class="fas fa-list mr-2"></i>Moderation Queue
                            </button>
                            <button onclick="showFlaggedContent()" class="bg-red-500 text-white py-2 px-6 rounded-lg hover:bg-red-600 transition-colors">
                                <i class="fas fa-exclamation-triangle mr-2"></i>Flagged Content
                            </button>
                            <button onclick="showAutoModerationSettings()" class="bg-gray-500 text-white py-2 px-6 rounded-lg hover:bg-gray-600 transition-colors">
                                <i class="fas fa-cog mr-2"></i>Auto-Moderation Settings
                            </button>
                        </div>
                        <div id="moderationQueue">
                            <!-- Moderation queue will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Details Modal -->
            <div id="userDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                <div class="bg-white rounded-lg max-w-4xl w-full mx-4 max-h-96 overflow-y-auto">
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-semibold text-gray-800">User Details</h3>
                            <button onclick="closeUserDetailsModal()" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <div id="userDetailsContent">
                            <!-- User details will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

                <!-- Content Moderation -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">
                        <i class="fas fa-flag text-orange-500 mr-2"></i>Content Moderation
                    </h3>
                    <div class="space-y-4">
                        <button onclick="loadModerationQueue()" class="w-full bg-orange-500 text-white py-3 px-6 rounded-lg hover:bg-orange-600 transition-colors">
                            <i class="fas fa-list mr-2"></i>Moderation Queue
                        </button>
                        <button onclick="showFlaggedContent()" class="w-full bg-red-500 text-white py-3 px-6 rounded-lg hover:bg-red-600 transition-colors">
                            <i class="fas fa-exclamation-triangle mr-2"></i>Flagged Content
                        </button>
                        <button onclick="showAutoModerationSettings()" class="w-full bg-gray-500 text-white py-3 px-6 rounded-lg hover:bg-gray-600 transition-colors">
                            <i class="fas fa-cog mr-2"></i>Auto-Moderation Settings
                        </button>
                    </div>
                    <div id="moderationQueue" class="mt-6">
                        <!-- Moderation queue will be loaded here -->
                    </div>
                </div>
            </div>


        </div>

        <!-- Analytics & Reporting Section -->
        <div id="analytics-section" class="dashboard-section" style="display: none;">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Analytics & Reporting</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- System Metrics -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">
                        <i class="fas fa-chart-line text-blue-500 mr-2"></i>System Metrics
                    </h3>
                    <div class="space-y-3">
                        <button onclick="loadMetrics('performance')" class="w-full text-left bg-gray-50 hover:bg-gray-100 p-3 rounded-lg transition-colors">
                            <i class="fas fa-tachometer-alt text-green-500 mr-2"></i>Performance Metrics
                        </button>
                        <button onclick="loadMetrics('usage')" class="w-full text-left bg-gray-50 hover:bg-gray-100 p-3 rounded-lg transition-colors">
                            <i class="fas fa-users text-blue-500 mr-2"></i>Usage Analytics
                        </button>
                        <button onclick="loadMetrics('errors')" class="w-full text-left bg-gray-50 hover:bg-gray-100 p-3 rounded-lg transition-colors">
                            <i class="fas fa-exclamation-circle text-red-500 mr-2"></i>Error Tracking
                        </button>
                    </div>
                </div>

                <!-- Financial Reports -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">
                        <i class="fas fa-dollar-sign text-green-500 mr-2"></i>Financial Reports
                    </h3>
                    <div class="space-y-3">
                        <button onclick="generateReport('revenue')" class="w-full text-left bg-gray-50 hover:bg-gray-100 p-3 rounded-lg transition-colors">
                            <i class="fas fa-chart-bar text-green-500 mr-2"></i>Revenue Report
                        </button>
                        <button onclick="generateReport('commissions')" class="w-full text-left bg-gray-50 hover:bg-gray-100 p-3 rounded-lg transition-colors">
                            <i class="fas fa-percentage text-blue-500 mr-2"></i>Commission Report
                        </button>
                        <button onclick="generateReport('subscriptions')" class="w-full text-left bg-gray-50 hover:bg-gray-100 p-3 rounded-lg transition-colors">
                            <i class="fas fa-credit-card text-purple-500 mr-2"></i>Subscription Report
                        </button>
                    </div>
                </div>

                <!-- User Analytics -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">
                        <i class="fas fa-user-chart text-purple-500 mr-2"></i>User Analytics
                    </h3>
                    <div class="space-y-3">
                        <button onclick="loadUserAnalytics('activity')" class="w-full text-left bg-gray-50 hover:bg-gray-100 p-3 rounded-lg transition-colors">
                            <i class="fas fa-clock text-orange-500 mr-2"></i>User Activity
                        </button>
                        <button onclick="loadUserAnalytics('retention')" class="w-full text-left bg-gray-50 hover:bg-gray-100 p-3 rounded-lg transition-colors">
                            <i class="fas fa-repeat text-indigo-500 mr-2"></i>Retention Analysis
                        </button>
                        <button onclick="loadUserAnalytics('engagement')" class="w-full text-left bg-gray-50 hover:bg-gray-100 p-3 rounded-lg transition-colors">
                            <i class="fas fa-heart text-red-500 mr-2"></i>Engagement Metrics
                        </button>
                    </div>
                </div>
            </div>

            <!-- Analytics Display Area -->
            <div class="mt-8 bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Analytics Dashboard</h3>
                <div id="analyticsDisplay" class="min-h-96 flex items-center justify-center text-gray-500">
                    Select an analytics option to view detailed reports and charts
                </div>
            </div>
        </div>

        <!-- Marketing & Growth Section -->
        <div id="marketing-section" class="dashboard-section" style="display: none;">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Marketing & Growth</h2>
            
            <!-- Marketing & Growth Management Tabs -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <div class="flex flex-wrap border-b border-gray-200 mb-6">
                    <button class="marketing-tab-button active" onclick="showMarketingTab('campaigns')" data-tab="campaigns">
                        <i class="fas fa-bullhorn mr-2"></i>Campaign Management
                    </button>
                    <button class="marketing-tab-button" onclick="showMarketingTab('growth-tools')" data-tab="growth-tools">
                        <i class="fas fa-rocket mr-2"></i>Growth Tools
                    </button>
                    <button class="marketing-tab-button" onclick="showMarketingTab('analytics')" data-tab="analytics">
                        <i class="fas fa-chart-bar mr-2"></i>Marketing Analytics
                    </button>
                </div>

                <!-- Campaign Management Tab -->
                <div id="campaigns-tab" class="marketing-tab-content">
                    <div class="flex flex-col lg:flex-row gap-6 mb-6">
                        <div class="flex gap-3">
                            <button onclick="loadMarketingCampaigns()" class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-colors">
                                <i class="fas fa-list mr-2"></i>View Campaigns
                            </button>
                            <button onclick="showCreateCampaignForm()" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">
                                <i class="fas fa-plus mr-2"></i>Create Campaign
                            </button>
                            <button onclick="showCampaignAnalytics()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                                <i class="fas fa-chart-line mr-2"></i>Campaign Analytics
                            </button>
                        </div>
                    </div>
                    <div id="campaignsTable" class="overflow-x-auto">
                        <!-- Campaigns table will be loaded here -->
                    </div>
                </div>

                <!-- Growth Tools Tab -->
                <div id="growth-tools-tab" class="marketing-tab-content" style="display: none;">
                    <div class="flex flex-col lg:flex-row gap-6 mb-6">
                        <div class="flex gap-3">
                            <button onclick="loadReferralProgram()" class="bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                                <i class="fas fa-users mr-2"></i>Referral Program
                            </button>
                            <button onclick="showPromoCodeManager()" class="bg-orange-500 text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition-colors">
                                <i class="fas fa-tag mr-2"></i>Promo Codes
                            </button>
                            <button onclick="loadNotificationCenter()" class="bg-indigo-500 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 transition-colors">
                                <i class="fas fa-bell mr-2"></i>Notifications
                            </button>
                        </div>
                    </div>
                    <div id="growthToolsContent">
                        <!-- Growth tools content will be loaded here -->
                    </div>
                </div>

                <!-- Marketing Analytics Tab -->
                <div id="analytics-tab" class="marketing-tab-content" style="display: none;">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-blue-50 p-6 rounded-lg">
                            <h4 class="font-semibold text-blue-700 mb-2">Campaign Performance</h4>
                            <p class="text-2xl font-bold text-blue-900">87.5%</p>
                            <p class="text-sm text-blue-600">Success Rate</p>
                        </div>
                        <div class="bg-green-50 p-6 rounded-lg">
                            <h4 class="font-semibold text-green-700 mb-2">Conversion Rate</h4>
                            <p class="text-2xl font-bold text-green-900">12.3%</p>
                            <p class="text-sm text-green-600">↑ 2.1% from last month</p>
                        </div>
                        <div class="bg-purple-50 p-6 rounded-lg">
                            <h4 class="font-semibold text-purple-700 mb-2">ROI</h4>
                            <p class="text-2xl font-bold text-purple-900">3.2x</p>
                            <p class="text-sm text-purple-600">Return on Investment</p>
                        </div>
                    </div>
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Detailed Analytics</h4>
                        <div id="marketingAnalyticsChart" class="bg-gray-50 p-6 rounded-lg">
                            <p class="text-gray-500 text-center">Analytics chart would be displayed here</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Marketing Dashboard -->
            <div class="mt-8 bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Marketing Dashboard</h3>
                <div id="marketingDashboard" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Marketing metrics will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Compliance & Security Section -->
        <div id="compliance-section" class="dashboard-section" style="display: none;">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Compliance & Security</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Security Monitoring -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">
                        <i class="fas fa-shield-alt text-green-500 mr-2"></i>Security Monitoring
                    </h3>
                    <div class="space-y-4">
                        <button onclick="loadSecurityLogs()" class="w-full bg-green-500 text-white py-3 px-6 rounded-lg hover:bg-green-600 transition-colors">
                            <i class="fas fa-file-alt mr-2"></i>Security Logs
                        </button>
                        <button onclick="showFailedLogins()" class="w-full bg-red-500 text-white py-3 px-6 rounded-lg hover:bg-red-600 transition-colors">
                            <i class="fas fa-exclamation-triangle mr-2"></i>Failed Login Attempts
                        </button>
                        <button onclick="loadSuspiciousActivities()" class="w-full bg-orange-500 text-white py-3 px-6 rounded-lg hover:bg-orange-600 transition-colors">
                            <i class="fas fa-search mr-2"></i>Suspicious Activities
                        </button>
                    </div>
                    <div id="securityMonitoringContent" class="mt-6">
                        <!-- Security monitoring content will be loaded here -->
                    </div>
                </div>

                <!-- Compliance Reports -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">
                        <i class="fas fa-clipboard-check text-blue-500 mr-2"></i>Compliance Reports
                    </h3>
                    <div class="space-y-4">
                        <button onclick="generateComplianceReport('privacy')" class="w-full bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600 transition-colors">
                            <i class="fas fa-user-secret mr-2"></i>Privacy Compliance
                        </button>
                        <button onclick="generateComplianceReport('data')" class="w-full bg-purple-500 text-white py-3 px-6 rounded-lg hover:bg-purple-600 transition-colors">
                            <i class="fas fa-database mr-2"></i>Data Protection
                        </button>
                        <button onclick="generateComplianceReport('audit')" class="w-full bg-indigo-500 text-white py-3 px-6 rounded-lg hover:bg-indigo-600 transition-colors">
                            <i class="fas fa-search-plus mr-2"></i>Security Audit
                        </button>
                    </div>
                    <div id="complianceReportsContent" class="mt-6">
                        <!-- Compliance reports content will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Compliance Dashboard -->
            <div class="mt-8 bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Compliance Status</h3>
                <div id="complianceDashboard" class="space-y-4">
                    <!-- Compliance status will be loaded here -->
                </div>
            </div>
        </div>

        <!-- API Documentation Section -->
        <div id="api-docs-section" class="dashboard-section" style="display: none;">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">API Documentation</h2>
            
            <!-- API Endpoints Overview -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-code text-indigo-500 mr-2"></i>Admin API Endpoints
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-2">Authentication</h4>
                        <p class="text-sm text-gray-600">Header: <code>x-user-id: 1</code></p>
                        <p class="text-sm text-gray-600">Admin access required for all endpoints</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-2">Base URL</h4>
                        <p class="text-sm text-gray-600"><code>/api/admin/</code></p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-2">Response Format</h4>
                        <p class="text-sm text-gray-600">JSON with <code>success</code> and <code>data</code> fields</p>
                    </div>
                </div>
                
                <!-- API Endpoint Categories -->
                <div class="space-y-4">
                    <button onclick="showAPICategory('dashboard')" class="w-full text-left bg-blue-50 hover:bg-blue-100 p-4 rounded-lg transition-colors">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-semibold text-blue-700">Dashboard APIs</h4>
                                <p class="text-sm text-blue-600">Dashboard metrics, activities, and overview data</p>
                            </div>
                            <i class="fas fa-chevron-right text-blue-500"></i>
                        </div>
                    </button>
                    
                    <button onclick="showAPICategory('user-management')" class="w-full text-left bg-green-50 hover:bg-green-100 p-4 rounded-lg transition-colors">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-semibold text-green-700">User Management APIs</h4>
                                <p class="text-sm text-green-600">Admin users, roles, and permissions management</p>
                            </div>
                            <i class="fas fa-chevron-right text-green-500"></i>
                        </div>
                    </button>
                    
                    <button onclick="showAPICategory('moderation')" class="w-full text-left bg-orange-50 hover:bg-orange-100 p-4 rounded-lg transition-colors">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-semibold text-orange-700">Content Moderation APIs</h4>
                                <p class="text-sm text-orange-600">Moderation queue, flagged content, and review actions</p>
                            </div>
                            <i class="fas fa-chevron-right text-orange-500"></i>
                        </div>
                    </button>
                    
                    <button onclick="showAPICategory('financial')" class="w-full text-left bg-purple-50 hover:bg-purple-100 p-4 rounded-lg transition-colors">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-semibold text-purple-700">Financial APIs</h4>
                                <p class="text-sm text-purple-600">Revenue tracking, financial reports, and analytics</p>
                            </div>
                            <i class="fas fa-chevron-right text-purple-500"></i>
                        </div>
                    </button>
                    
                    <button onclick="showAPICategory('system')" class="w-full text-left bg-red-50 hover:bg-red-100 p-4 rounded-lg transition-colors">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-semibold text-red-700">System Monitoring APIs</h4>
                                <p class="text-sm text-red-600">Metrics, error logs, and system health monitoring</p>
                            </div>
                            <i class="fas fa-chevron-right text-red-500"></i>
                        </div>
                    </button>
                    
                    <button onclick="showAPICategory('feature-flags')" class="w-full text-left bg-indigo-50 hover:bg-indigo-100 p-4 rounded-lg transition-colors">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-semibold text-indigo-700">Feature Flags APIs</h4>
                                <p class="text-sm text-indigo-600">Feature flag management and evaluation</p>
                            </div>
                            <i class="fas fa-chevron-right text-indigo-500"></i>
                        </div>
                    </button>
                </div>
            </div>

            <!-- API Details Display -->
            <div id="apiDetails" class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Select an API category above to view detailed documentation</h3>
                <p class="text-gray-600">Each category contains multiple endpoints with request/response examples, parameters, and usage instructions.</p>
            </div>
        </div>

        <!-- Feature Flags Management Section -->
        <div id="feature-flags-section" class="dashboard-section" style="display: none;">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Feature Flags Management</h2>
            
            <!-- Feature Flags Overview -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">
                            <i class="fas fa-toggle-on text-indigo-500 mr-2"></i>Platform Feature Controls
                        </h3>
                        <p class="text-gray-600">Enable or disable platform features instantly without code deployment. Perfect for A/B testing, gradual rollouts, and emergency controls.</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="loadFeatureFlags()" class="bg-indigo-500 text-white py-2 px-6 rounded-lg hover:bg-indigo-600 transition-colors">
                            <i class="fas fa-sync mr-2"></i>Refresh Flags
                        </button>
                        <button onclick="showCreateFlagForm()" class="bg-green-500 text-white py-2 px-6 rounded-lg hover:bg-green-600 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Create Flag
                        </button>
                    </div>
                </div>
                
                <!-- Feature Flags Statistics -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-blue-600">Total Flags</p>
                                <p id="totalFlags" class="text-2xl font-bold text-blue-900">-</p>
                            </div>
                            <i class="fas fa-flag text-blue-500 text-xl"></i>
                        </div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-green-600">Active Flags</p>
                                <p id="activeFlags" class="text-2xl font-bold text-green-900">-</p>
                            </div>
                            <i class="fas fa-check-circle text-green-500 text-xl"></i>
                        </div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-yellow-600">Inactive Flags</p>
                                <p id="inactiveFlags" class="text-2xl font-bold text-yellow-900">-</p>
                            </div>
                            <i class="fas fa-pause-circle text-yellow-500 text-xl"></i>
                        </div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-purple-600">Rollout %</p>
                                <p id="avgRollout" class="text-2xl font-bold text-purple-900">-</p>
                            </div>
                            <i class="fas fa-percentage text-purple-500 text-xl"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Feature Flags Table -->
                <div id="featureFlagsTable" class="overflow-x-auto">
                    <!-- Feature flags table will be loaded here -->
                </div>
            </div>
            
            <!-- Feature Flags Help -->
            <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-6">
                <h4 class="text-lg font-semibold text-gray-800 mb-3">
                    <i class="fas fa-info-circle text-indigo-500 mr-2"></i>Feature Flags Best Practices
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h5 class="font-medium text-gray-700 mb-2">🎯 Gradual Rollouts</h5>
                        <p class="text-sm text-gray-600">Start with 5-10% rollout, monitor metrics, then increase gradually</p>
                    </div>
                    <div>
                        <h5 class="font-medium text-gray-700 mb-2">🚨 Emergency Control</h5>
                        <p class="text-sm text-gray-600">Instantly disable features during incidents without code deployment</p>
                    </div>
                    <div>
                        <h5 class="font-medium text-gray-700 mb-2">🧪 A/B Testing</h5>
                        <p class="text-sm text-gray-600">Test different features with user segments for data-driven decisions</p>
                    </div>
                    <div>
                        <h5 class="font-medium text-gray-700 mb-2">📊 Monitor Impact</h5>
                        <p class="text-sm text-gray-600">Watch error rates, performance metrics, and user feedback closely</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 text-center">
            <i class="fas fa-spinner fa-spin text-3xl text-kwikr-green mb-4"></i>
            <p class="text-gray-700">Loading...</p>
        </div>
    </div>

    <style>
        .tab-button {
            padding: 12px 24px;
            border-bottom: 2px solid transparent;
            color: #6b7280;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            background: none;
            border-top: none;
            border-left: none;
            border-right: none;
        }
        
        .tab-button:hover {
            color: #00C881;
            border-bottom-color: #00C881;
        }
        
        .tab-button.active {
            color: #00C881;
            border-bottom-color: #00C881;
            font-weight: 600;
        }
        
        .dashboard-section {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .management-tab-button {
            padding: 12px 24px;
            border-bottom: 2px solid transparent;
            color: #6b7280;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            background: none;
            border-top: none;
            border-left: none;
            border-right: none;
            margin-right: 8px;
        }
        
        .management-tab-button:hover {
            color: #00C881;
            border-bottom-color: #00C881;
        }
        
        .management-tab-button.active {
            color: #00C881;
            border-bottom-color: #00C881;
            font-weight: 600;
        }
        
        .management-tab-content {
            animation: fadeIn 0.3s ease-in-out;
        }

        .marketing-tab-button {
            padding: 12px 24px;
            border-bottom: 2px solid transparent;
            color: #6b7280;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            background: none;
            border-top: none;
            border-left: none;
            border-right: none;
            margin-right: 8px;
        }
        
        .marketing-tab-button:hover {
            color: #00C881;
            border-bottom-color: #00C881;
        }
        
        .marketing-tab-button.active {
            color: #00C881;
            border-bottom-color: #00C881;
            font-weight: 600;
        }
        
        .marketing-tab-content {
            animation: fadeIn 0.3s ease-in-out;
        }
    </style>

    <script>
        // Admin Dashboard JavaScript Functions
        let currentAdminUser = null;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadAdminUserInfo();
            loadDashboardOverview();
        });
        
        // Show/Hide sections
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.dashboard-section');
            sections.forEach(section => section.style.display = 'none');
            
            // Show selected section
            document.getElementById(sectionName + '-section').style.display = 'block';
            
            // Update active tab
            const tabs = document.querySelectorAll('.tab-button');
            tabs.forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
            
            // Load section-specific data
            switch(sectionName) {
                case 'admin-panel':
                    loadAdminPanelStats();
                    loadPlatformUsers(); // Load platform users by default
                    break;
                case 'feature-flags':
                    loadFeatureFlags();
                    loadFeatureFlagsStats();
                    break;
                case 'analytics':
                    // Analytics loaded on demand
                    break;
                case 'marketing':
                    showMarketingTab('campaigns'); // Load campaigns tab by default
                    break;
                case 'compliance':
                    loadComplianceDashboard();
                    break;
            }
        }
        
        // Admin API Helper
        async function adminAPI(endpoint, method = 'GET', data = null) {
            const config = {
                method: method,
                url: `/api/admin${endpoint}`,
                headers: {
                    'x-user-id': '1', // Admin user ID
                    'Content-Type': 'application/json'
                }
            };
            
            if (data && (method === 'POST' || method === 'PUT' || method === 'PATCH')) {
                config.data = data;
            }
            
            try {
                const response = await axios(config);
                return response.data;
            } catch (error) {
                console.error('Admin API Error:', error);
                if (error.response?.status === 401 || error.response?.status === 403) {
                    showNotification('Admin access required. Please login as admin.', 'error');
                    setTimeout(() => {
                        window.location.href = '/auth/login';
                    }, 2000);
                }
                throw error;
            }
        }
        
        // Load admin user info
        async function loadAdminUserInfo() {
            try {
                const response = await adminAPI('/permissions');
                if (response.success) {
                    currentAdminUser = response.data.user;
                    document.getElementById('adminUserInfo').textContent = 
                        `${currentAdminUser.role_name} - ${currentAdminUser.user_email || 'Admin User'}`;
                }
            } catch (error) {
                document.getElementById('adminUserInfo').textContent = 'Error loading admin info';
            }
        }
        
        // Load dashboard overview
        async function loadDashboardOverview() {
            try {
                const [metrics, activities] = await Promise.all([
                    adminAPI('/dashboard'),
                    adminAPI('/dashboard/activities?limit=10')
                ]);
                
                if (metrics.success) {
                    const data = metrics.data.metrics;
                    document.getElementById('activeUsers').textContent = data.active_users?.value || '0';
                    document.getElementById('totalJobs').textContent = data.total_jobs?.value || '0';
                    document.getElementById('revenueToday').textContent = `$${data.revenue_today?.value || '0.00'}`;
                    document.getElementById('errorRate').textContent = `${(data.error_rate?.value * 100 || 0).toFixed(2)}%`;
                }
                
                if (activities.success) {
                    displayRecentActivities(activities.data);
                }
                
                // Load charts
                loadDashboardCharts();
                
            } catch (error) {
                console.error('Error loading dashboard overview:', error);
            }
        }
        
        // Display recent activities
        function displayRecentActivities(activities) {
            const container = document.getElementById('recentActivities');
            if (!activities || activities.length === 0) {
                container.innerHTML = '<p class="text-gray-500">No recent activities</p>';
                return;
            }
            
            container.innerHTML = activities.map(activity => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-user-cog text-kwikr-green mr-3"></i>
                        <div>
                            <p class="font-medium text-gray-800">${activity.action}</p>
                            <p class="text-sm text-gray-500">${activity.target_type} #${activity.target_id || 'N/A'}</p>
                        </div>
                    </div>
                    <span class="text-sm text-gray-400">${new Date(activity.created_at).toLocaleDateString()}</span>
                </div>
            `).join('');
        }
        
        // Load dashboard charts
        function loadDashboardCharts() {
            // User Activity Chart
            const userCtx = document.getElementById('userActivityChart').getContext('2d');
            new Chart(userCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Active Users',
                        data: [65, 78, 90, 110, 125, 150],
                        borderColor: '#00C881',
                        backgroundColor: 'rgba(0, 200, 129, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            new Chart(revenueCtx, {
                type: 'bar',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Revenue ($)',
                        data: [3200, 4100, 3800, 5200],
                        backgroundColor: '#00C881',
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Feature Flags Management
        async function loadFeatureFlags() {
            try {
                const response = await adminAPI('/feature-flags');
                if (response.success) {
                    displayFeatureFlags(response.data);
                    updateFeatureFlagsStats(response.data);
                }
            } catch (error) {
                console.error('Error loading feature flags:', error);
            }
        }
        
        // Load feature flags statistics
        async function loadFeatureFlagsStats() {
            // This will be called along with loadFeatureFlags
            // Stats are updated in updateFeatureFlagsStats function
        }
        
        // Update feature flags statistics
        function updateFeatureFlagsStats(flags) {
            if (!flags) return;
            
            const totalFlags = flags.length;
            const activeFlags = flags.filter(f => f.is_active).length;
            const inactiveFlags = totalFlags - activeFlags;
            const avgRollout = flags.length > 0 ? 
                Math.round(flags.reduce((sum, f) => sum + (f.rollout_percentage || 0), 0) / flags.length) : 0;
            
            // Update stats in feature flags section
            const totalEl = document.getElementById('totalFlags');
            const activeEl = document.getElementById('activeFlags');
            const inactiveEl = document.getElementById('inactiveFlags');
            const rolloutEl = document.getElementById('avgRollout');
            
            if (totalEl) totalEl.textContent = totalFlags;
            if (activeEl) activeEl.textContent = activeFlags;
            if (inactiveEl) inactiveEl.textContent = inactiveFlags;
            if (rolloutEl) rolloutEl.textContent = avgRollout + '%';
        }
        
        function displayFeatureFlags(flags) {
            const container = document.getElementById('featureFlagsTable');
            
            if (!flags || flags.length === 0) {
                container.innerHTML = '<p class="text-gray-500">No feature flags found</p>';
                return;
            }
            
            container.innerHTML = `
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Flag Key</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Value</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        ${flags.map(flag => `
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap font-mono text-sm">${flag.flag_key}</td>
                                <td class="px-6 py-4 whitespace-nowrap">${flag.name}</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 py-1 text-xs font-semibold rounded-full ${flag.default_value === 'true' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${flag.default_value}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 py-1 text-xs font-semibold rounded-full ${flag.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                        ${flag.is_active ? 'Active' : 'Inactive'}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button onclick="toggleFeatureFlag(${flag.id})" 
                                            class="px-3 py-1 rounded text-sm font-medium transition-colors ${flag.is_active ? 'bg-red-100 text-red-700 hover:bg-red-200' : 'bg-green-100 text-green-700 hover:bg-green-200'}">
                                        ${flag.is_active ? 'Disable' : 'Enable'}
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        // Toggle feature flag
        async function toggleFeatureFlag(flagId) {
            // Prevent multiple clicks by disabling all toggle buttons
            const toggleButtons = document.querySelectorAll(`button[onclick*="toggleFeatureFlag"]`);
            toggleButtons.forEach(btn => {
                btn.disabled = true;
                btn.textContent = 'Processing...';
                btn.className = btn.className.replace(/bg-(red|green)-100/, 'bg-gray-100').replace(/text-(red|green)-700/, 'text-gray-500');
            });
            
            try {
                // First, get the current state of the flag
                const currentFlags = await adminAPI('/feature-flags');
                if (!currentFlags.success) {
                    throw new Error('Could not retrieve current flag state');
                }
                
                const currentFlag = currentFlags.data.find(f => f.id === flagId);
                if (!currentFlag) {
                    throw new Error('Feature flag not found');
                }
                
                // Toggle the current state
                const newState = currentFlag.is_active ? false : true;
                
                const response = await adminAPI(`/feature-flags/${flagId}`, 'PUT', {
                    is_active: newState
                });
                
                if (response.success) {
                    const action = newState ? 'enabled' : 'disabled';
                    showNotification(`Feature flag "${currentFlag.name}" ${action} successfully!`, 'success');
                    loadFeatureFlags(); // Reload the table which will re-enable buttons
                }
            } catch (error) {
                showNotification('Error toggling feature flag: ' + error.message, 'error');
                // Re-enable buttons and reload on error
                loadFeatureFlags();
            }
        }
        
        // Marketing dashboard
        function loadMarketingDashboard() {
            const container = document.getElementById('marketingDashboard');
            container.innerHTML = `
                <div class="bg-blue-50 p-6 rounded-lg">
                    <h4 class="font-semibold text-blue-700 mb-2">Active Campaigns</h4>
                    <p class="text-2xl font-bold text-blue-900">8</p>
                    <p class="text-sm text-blue-600">2 ending this week</p>
                </div>
                <div class="bg-green-50 p-6 rounded-lg">
                    <h4 class="font-semibold text-green-700 mb-2">Conversion Rate</h4>
                    <p class="text-2xl font-bold text-green-900">12.5%</p>
                    <p class="text-sm text-green-600">↑ 2.3% from last month</p>
                </div>
                <div class="bg-purple-50 p-6 rounded-lg">
                    <h4 class="font-semibold text-purple-700 mb-2">Referral Signups</h4>
                    <p class="text-2xl font-bold text-purple-900">124</p>
                    <p class="text-sm text-purple-600">This month</p>
                </div>
            `;
        }
        
        // Marketing analytics
        function loadMarketingAnalytics() {
            const container = document.getElementById('marketingAnalyticsChart');
            if (container) {
                container.innerHTML = `
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            <div class="text-center">
                                <p class="text-2xl font-bold text-blue-600">24</p>
                                <p class="text-sm text-gray-600">Total Campaigns</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-green-600">8</p>
                                <p class="text-sm text-gray-600">Active Campaigns</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-purple-600">1,245</p>
                                <p class="text-sm text-gray-600">Total Leads</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-orange-600">$12,450</p>
                                <p class="text-sm text-gray-600">Revenue Generated</p>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <h5 class="font-medium mb-2">Campaign Performance Chart</h5>
                            <p class="text-gray-500 text-sm">Interactive chart showing campaign performance over time would be displayed here using Chart.js or similar library.</p>
                        </div>
                    </div>
                `;
            }
        }
        
        // Compliance dashboard
        function loadComplianceDashboard() {
            const container = document.getElementById('complianceDashboard');
            container.innerHTML = `
                <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-500 text-2xl mr-4"></i>
                        <div>
                            <h4 class="font-semibold text-green-700">GDPR Compliance</h4>
                            <p class="text-sm text-green-600">All requirements met</p>
                        </div>
                    </div>
                    <span class="text-green-500 font-semibold">✓</span>
                </div>
                <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-shield-alt text-green-500 text-2xl mr-4"></i>
                        <div>
                            <h4 class="font-semibold text-green-700">Data Encryption</h4>
                            <p class="text-sm text-green-600">All data encrypted at rest and in transit</p>
                        </div>
                    </div>
                    <span class="text-green-500 font-semibold">✓</span>
                </div>
                <div class="flex items-center justify-between p-4 bg-yellow-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-yellow-500 text-2xl mr-4"></i>
                        <div>
                            <h4 class="font-semibold text-yellow-700">Security Audit</h4>
                            <p class="text-sm text-yellow-600">Due in 15 days</p>
                        </div>
                    </div>
                    <span class="text-yellow-500 font-semibold">⚠</span>
                </div>
            `;
        }
        
        // API Documentation
        function showAPICategory(category) {
            const container = document.getElementById('apiDetails');
            
            const apiDocs = {
                'dashboard': {
                    title: 'Dashboard APIs',
                    endpoints: [
                        {
                            method: 'GET',
                            endpoint: '/dashboard',
                            description: 'Get comprehensive dashboard metrics and overview',
                            response: '{"success": true, "data": {"metrics": {...}, "recent_activities": [...]}}'
                        },
                        {
                            method: 'GET',
                            endpoint: '/dashboard/metrics/:metric_type',
                            description: 'Get specific metric type data',
                            response: '{"success": true, "data": [...]}'
                        }
                    ]
                },
                'user-management': {
                    title: 'User Management APIs',
                    endpoints: [
                        {
                            method: 'GET',
                            endpoint: '/users',
                            description: 'Get all admin users with role information',
                            response: '{"success": true, "data": [...]}'
                        },
                        {
                            method: 'POST',
                            endpoint: '/users',
                            description: 'Create new admin user',
                            body: '{"user_id": 123, "admin_role_id": 1, "notes": "..."}',
                            response: '{"success": true, "data": {...}}'
                        }
                    ]
                }
                // Add more categories as needed
            };
            
            const doc = apiDocs[category];
            if (!doc) {
                container.innerHTML = '<p class="text-gray-500">API documentation not found</p>';
                return;
            }
            
            container.innerHTML = `
                <h3 class="text-xl font-semibold text-gray-800 mb-6">${doc.title}</h3>
                <div class="space-y-6">
                    ${doc.endpoints.map(endpoint => `
                        <div class="border border-gray-200 rounded-lg p-6">
                            <div class="flex items-center mb-4">
                                <span class="px-3 py-1 text-sm font-semibold rounded ${endpoint.method === 'GET' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}">${endpoint.method}</span>
                                <code class="ml-3 text-gray-700">/api/admin${endpoint.endpoint}</code>
                            </div>
                            <p class="text-gray-600 mb-4">${endpoint.description}</p>
                            ${endpoint.body ? `
                                <div class="mb-4">
                                    <h5 class="font-semibold text-gray-700 mb-2">Request Body:</h5>
                                    <pre class="bg-gray-100 p-3 rounded text-sm overflow-x-auto">${endpoint.body}</pre>
                                </div>
                            ` : ''}
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">Response:</h5>
                                <pre class="bg-gray-100 p-3 rounded text-sm overflow-x-auto">${endpoint.response}</pre>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        // Platform Management Functions
        
        // Management tab switching
        function showManagementTab(tabName) {
            // Hide all tab contents
            const tabs = document.querySelectorAll('.management-tab-content');
            tabs.forEach(tab => tab.style.display = 'none');
            
            // Show selected tab
            document.getElementById(tabName + '-tab').style.display = 'block';
            
            // Update active tab button
            const buttons = document.querySelectorAll('.management-tab-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Load tab-specific data
            switch(tabName) {
                case 'platform-users':
                    loadPlatformUsers();
                    break;
                case 'job-management':
                    loadPlatformJobs();
                    break;
                case 'admin-users':
                    loadAdminUsers();
                    break;
                case 'content-moderation':
                    loadModerationQueue();
                    break;
            }
        }

        // Marketing tab switching
        function showMarketingTab(tabName) {
            // Hide all tab contents
            const tabs = document.querySelectorAll('.marketing-tab-content');
            tabs.forEach(tab => tab.style.display = 'none');
            
            // Show selected tab
            document.getElementById(tabName + '-tab').style.display = 'block';
            
            // Update active tab button
            const buttons = document.querySelectorAll('.marketing-tab-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Load tab-specific data
            switch(tabName) {
                case 'campaigns':
                    loadMarketingCampaigns();
                    break;
                case 'growth-tools':
                    // Growth tools loaded on demand
                    break;
                case 'analytics':
                    loadMarketingAnalytics();
                    break;
            }
        }

        // Load platform users
        async function loadPlatformUsers(search = '', role = '', status = '') {
            try {
                const params = new URLSearchParams();
                if (search) params.append('search', search);
                if (role) params.append('role', role);
                if (status) params.append('status', status);
                params.append('limit', '100');

                const response = await adminAPI(`/platform/users?${params.toString()}`);
                if (response.success) {
                    displayPlatformUsers(response.data);
                    updatePlatformStats(response.data);
                }
            } catch (error) {
                console.error('Error loading platform users:', error);
            }
        }

        // Display platform users table
        function displayPlatformUsers(users) {
            const container = document.getElementById('platformUsersTable');
            
            if (!users || users.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No users found</p>';
                return;
            }
            
            container.innerHTML = `
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">User</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Role</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Contact</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Stats</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Joined</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        ${users.map(user => `
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 h-10 w-10">
                                            <div class="h-10 w-10 rounded-full bg-kwikr-green flex items-center justify-center text-white font-semibold">
                                                ${user.first_name?.[0] || 'U'}${user.last_name?.[0] || ''}
                                            </div>
                                        </div>
                                        <div class="ml-4">
                                            <div class="text-sm font-medium text-gray-900">${user.first_name || ''} ${user.last_name || ''}</div>
                                            <div class="text-sm text-gray-500">ID: ${user.id}</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getRoleBadgeColor(user.role)}">
                                        ${user.role}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    <div>${user.email}</div>
                                    ${user.phone ? `<div class="text-gray-500">${user.phone}</div>` : ''}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                    <div>Jobs: ${user.active_jobs || 0}/${user.completed_jobs || 0}</div>
                                    ${user.average_rating ? `<div>Rating: ${parseFloat(user.average_rating).toFixed(1)}/5</div>` : ''}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${user.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${user.is_active ? 'Active' : 'Inactive'}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                    ${new Date(user.created_at).toLocaleDateString()}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button onclick="viewUserDetails(${user.id})" class="text-kwikr-green hover:text-green-600">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button onclick="editUser(${user.id})" class="text-blue-600 hover:text-blue-500">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="toggleUserStatus(${user.id}, ${user.is_active})" class="text-${user.is_active ? 'red' : 'green'}-600 hover:text-${user.is_active ? 'red' : 'green'}-500">
                                        <i class="fas fa-${user.is_active ? 'ban' : 'check'}"></i>
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Load platform jobs
        async function loadPlatformJobs(search = '', status = '') {
            try {
                const params = new URLSearchParams();
                if (search) params.append('search', search);
                if (status) params.append('status', status);
                params.append('limit', '100');

                const response = await adminAPI(`/platform/jobs?${params.toString()}`);
                if (response.success) {
                    displayPlatformJobs(response.data);
                }
            } catch (error) {
                console.error('Error loading platform jobs:', error);
            }
        }

        // Display platform jobs table
        function displayPlatformJobs(jobs) {
            const container = document.getElementById('platformJobsTable');
            
            if (!jobs || jobs.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No jobs found</p>';
                return;
            }
            
            container.innerHTML = `
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Job</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Client</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Worker</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Budget</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Applications</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Created</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        ${jobs.map(job => `
                            <tr>
                                <td class="px-6 py-4">
                                    <div class="text-sm font-medium text-gray-900">${job.title}</div>
                                    <div class="text-sm text-gray-500">${job.category_name || 'No category'}</div>
                                    <div class="text-sm text-gray-500">${job.location || 'No location'}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    <div class="font-medium text-gray-900">${job.client_name || 'Unknown'}</div>
                                    <div class="text-gray-500">${job.client_email || ''}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    ${job.worker_name ? `
                                        <div class="font-medium text-gray-900">${job.worker_name}</div>
                                        <div class="text-gray-500">${job.worker_email}</div>
                                    ` : '<span class="text-gray-400">Not assigned</span>'}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getJobStatusBadgeColor(job.status)}">
                                        ${job.status}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    $${job.budget_min || 0} - $${job.budget_max || 0}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    ${job.application_count || 0}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                    ${new Date(job.created_at).toLocaleDateString()}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button onclick="viewJobDetails(${job.id})" class="text-kwikr-green hover:text-green-600">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button onclick="editJob(${job.id})" class="text-blue-600 hover:text-blue-500">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // View user details
        async function viewUserDetails(userId) {
            try {
                const response = await adminAPI(`/platform/users/${userId}`);
                if (response.success) {
                    showUserDetailsModal(response.data);
                }
            } catch (error) {
                alert('Error loading user details: ' + error.message);
            }
        }

        // Show user details modal
        function showUserDetailsModal(userData) {
            const { user, jobs, reviews, worker_profile, stats } = userData;
            
            document.getElementById('userDetailsContent').innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- User Info -->
                    <div class="space-y-4">
                        <h4 class="font-semibold text-lg">User Information</h4>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Name:</strong> ${user.full_name}</p>
                            <p><strong>Email:</strong> ${user.email}</p>
                            <p><strong>Phone:</strong> ${user.phone || 'Not provided'}</p>
                            <p><strong>Role:</strong> ${user.role}</p>
                            <p><strong>Location:</strong> ${user.city || ''}, ${user.province || ''}</p>
                            <p><strong>Verified:</strong> ${user.is_verified ? 'Yes' : 'No'}</p>
                            <p><strong>Active:</strong> ${user.is_active ? 'Yes' : 'No'}</p>
                            <p><strong>Joined:</strong> ${new Date(user.created_at).toLocaleDateString()}</p>
                        </div>
                    </div>

                    <!-- Stats -->
                    <div class="space-y-4">
                        <h4 class="font-semibold text-lg">Statistics</h4>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Total Jobs:</strong> ${stats.total_jobs}</p>
                            <p><strong>Active Jobs:</strong> ${stats.active_jobs}</p>
                            <p><strong>Completed Jobs:</strong> ${stats.completed_jobs}</p>
                            <p><strong>Reviews:</strong> ${stats.total_reviews}</p>
                            <p><strong>Average Rating:</strong> ${stats.average_rating ? stats.average_rating.toFixed(1) : 'N/A'}/5</p>
                        </div>
                    </div>
                </div>

                ${worker_profile ? `
                    <div class="mt-6">
                        <h4 class="font-semibold text-lg mb-3">Worker Profile</h4>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Hourly Rate:</strong> $${worker_profile.hourly_rate || 'Not set'}</p>
                            <p><strong>Experience:</strong> ${worker_profile.experience_years || 'Not specified'} years</p>
                            <p><strong>Skills:</strong> ${worker_profile.skills || 'None listed'}</p>
                            <p><strong>Service Areas:</strong> ${worker_profile.service_areas || 'None listed'}</p>
                        </div>
                    </div>
                ` : ''}

                <div class="mt-6 flex gap-3">
                    <button onclick="editUser(${user.id})" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        Edit User
                    </button>
                    <button onclick="toggleUserStatus(${user.id}, ${user.is_active})" class="bg-${user.is_active ? 'red' : 'green'}-500 text-white px-4 py-2 rounded hover:bg-${user.is_active ? 'red' : 'green'}-600">
                        ${user.is_active ? 'Deactivate' : 'Activate'} User
                    </button>
                </div>
            `;
            
            document.getElementById('userDetailsModal').classList.remove('hidden');
            document.getElementById('userDetailsModal').classList.add('flex');
        }

        // Close user details modal
        function closeUserDetailsModal() {
            document.getElementById('userDetailsModal').classList.add('hidden');
            document.getElementById('userDetailsModal').classList.remove('flex');
        }

        // Load admin panel stats
        async function loadAdminPanelStats() {
            try {
                const response = await adminAPI('/platform/stats');
                if (response.success) {
                    const stats = response.data;
                    document.getElementById('totalPlatformUsers').textContent = stats.total_users || '0';
                    document.getElementById('totalWorkers').textContent = stats.total_workers || '0';
                    document.getElementById('totalClients').textContent = stats.total_clients || '0';
                    document.getElementById('totalActiveJobs').textContent = stats.total_active_jobs || '0';
                }
            } catch (error) {
                console.error('Error loading platform stats:', error);
                // Set default values on error
                document.getElementById('totalPlatformUsers').textContent = '0';
                document.getElementById('totalWorkers').textContent = '0';
                document.getElementById('totalClients').textContent = '0';
                document.getElementById('totalActiveJobs').textContent = '0';
            }
        }
        
        // Update platform stats
        function updatePlatformStats(users) {
            const totalUsers = users.length;
            const workers = users.filter(u => u.role === 'worker').length;
            const clients = users.filter(u => u.role === 'client').length;
            const activeJobs = users.reduce((sum, u) => sum + (u.active_jobs || 0), 0);

            document.getElementById('totalPlatformUsers').textContent = totalUsers;
            document.getElementById('totalWorkers').textContent = workers;
            document.getElementById('totalClients').textContent = clients;
            document.getElementById('totalActiveJobs').textContent = activeJobs;
        }

        // Helper functions
        function getRoleBadgeColor(role) {
            switch(role) {
                case 'client': return 'bg-blue-100 text-blue-800';
                case 'worker': return 'bg-green-100 text-green-800';
                case 'admin': return 'bg-purple-100 text-purple-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getJobStatusBadgeColor(status) {
            switch(status) {
                case 'active': return 'bg-green-100 text-green-800';
                case 'in_progress': return 'bg-blue-100 text-blue-800';
                case 'completed': return 'bg-gray-100 text-gray-800';
                case 'cancelled': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Search and filter functions
        function searchUsers() {
            const search = document.getElementById('userSearchInput').value;
            const role = document.getElementById('userRoleFilter').value;
            const status = document.getElementById('userStatusFilter').value;
            loadPlatformUsers(search, role, status);
        }

        function filterUsers() {
            searchUsers();
        }

        function searchJobs() {
            const search = document.getElementById('jobSearchInput').value;
            const status = document.getElementById('jobStatusFilter').value;
            loadPlatformJobs(search, status);
        }

        function filterJobs() {
            searchJobs();
        }

        // Toggle user status
        async function toggleUserStatus(userId, currentStatus) {
            try {
                const action = currentStatus ? 'deactivate' : 'activate';
                if (!confirm(`Are you sure you want to ${action} this user?`)) return;

                const response = await adminAPI(`/platform/users/${userId}`, 'PUT', {
                    is_active: !currentStatus,
                    admin_action: `user_${action}d`
                });

                if (response.success) {
                    showNotification(`User ${action}d successfully`, 'success');
                    loadPlatformUsers(); // Reload the table
                }
            } catch (error) {
                showNotification(`Error ${currentStatus ? 'deactivating' : 'activating'} user: ` + error.message, 'error');
            }
        }

        // Placeholder functions for other features
        async function loadAdminUsers() {
            const container = document.getElementById('adminUsersTable');
            container.innerHTML = `
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Admin</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Role</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Last Login</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="font-medium text-gray-900">System Administrator</div>
                                    <div class="text-sm text-gray-500">admin@kwikr.ca</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">Super Admin</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Active</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Just now</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button onclick="editAdmin(1)" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</button>
                                    <button onclick="viewAdminActivity(1)" class="text-green-600 hover:text-green-900">Activity</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }
        function showCreateAdminForm() { showNotification('Create Admin functionality available in next update', 'info'); }
        function showRoleManagement() { showNotification('Role Management functionality available in next update', 'info'); }
        async function loadModerationQueue() {
            const mockData = [
                { id: 1, type: 'user_profile', reporter: 'Anonymous', reason: 'Inappropriate content', status: 'pending', created_at: '2024-09-07 16:20:00' },
                { id: 2, type: 'job_post', reporter: 'Sarah Johnson', reason: 'Suspicious pricing', status: 'under_review', created_at: '2024-09-07 14:15:00' }
            ];
            const container = document.getElementById('moderationQueue');
            container.innerHTML = `
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Content Type</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Reporter</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Reason</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            ${mockData.map(item => `
                                <tr data-moderation-id="${item.id}">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">${item.type.replace('_', ' ')}</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap font-medium">${item.reporter}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.reason}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${item.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-orange-100 text-orange-800'}">${item.status}</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.created_at}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="reviewContent(${item.id})" class="text-green-600 hover:text-green-900 mr-3">Review</button>
                                        <button onclick="dismissReport(${item.id})" class="text-red-600 hover:text-red-900">Dismiss</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        function showFlaggedContent() { showNotification('Flagged Content review functionality available in next update', 'info'); }
        function showAutoModerationSettings() { showNotification('Auto Moderation Settings available in next update', 'info'); }
        function editUser(userId) { showNotification('Edit User functionality available in next update', 'info'); }
        function viewJobDetails(jobId) { showNotification('View Job Details functionality available in next update', 'info'); }
        function editJob(jobId) { showNotification('Edit Job functionality available in next update', 'info'); }
        function showCreateFlagForm() { showNotification('Create Feature Flag functionality available in next update', 'info'); }
        function loadMetrics(type) { showNotification(`Loading ${type} metrics - functionality available in next update`, 'info'); }
        function generateReport(type) { showNotification(`Generating ${type} report - functionality available in next update`, 'info'); }
        function loadUserAnalytics(type) { showNotification(`Loading ${type} analytics - functionality available in next update`, 'info'); }
        // Marketing & Campaign Functions
        async function loadMarketingCampaigns() {
            try {
                // Clear growth tools content when loading campaigns
                document.getElementById('growthToolsContent').innerHTML = '';
                
                const response = await adminAPI('/campaigns');
                if (response.success) {
                    displayCampaignsTable(response.data);
                }
            } catch (error) {
                console.error('Error loading campaigns:', error);
                showNotification('Error loading campaigns', 'error');
            }
        }

        function displayCampaignsTable(campaigns) {
            const container = document.getElementById('campaignsTable');
            if (!campaigns || campaigns.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No campaigns found</p>';
                return;
            }

            const table = `
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Campaign</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Budget</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Performance</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${campaigns.map(campaign => `
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="font-medium text-gray-900">${campaign.name}</div>
                                        <div class="text-sm text-gray-500">${campaign.start_date} - ${campaign.end_date}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                                            ${campaign.type}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${getStatusColor(campaign.status)}">
                                            ${campaign.status}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">$${campaign.budget?.toLocaleString()}</div>
                                        <div class="text-sm text-gray-500">Spent: $${campaign.spend?.toLocaleString()}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        <div>${campaign.conversions || 0} conversions</div>
                                        <div class="text-gray-500">${campaign.clicks || 0} clicks</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="editCampaign(${campaign.id})" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</button>
                                        <button onclick="viewCampaignDetails(${campaign.id})" class="text-green-600 hover:text-green-900">View</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            container.innerHTML = table;
        }

        function getStatusColor(status) {
            switch (status) {
                case 'active': return 'bg-green-100 text-green-800';
                case 'scheduled': return 'bg-yellow-100 text-yellow-800';
                case 'completed': return 'bg-blue-100 text-blue-800';
                case 'paused': return 'bg-gray-100 text-gray-800';
                case 'draft': return 'bg-purple-100 text-purple-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function showCreateCampaignForm() {
            const modal = `
                <div id="campaignModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
                    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                        <div class="mt-3">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Create New Campaign</h3>
                            <form id="createCampaignForm" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Campaign Name</label>
                                        <input type="text" name="name" required class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-kwikr-green focus:border-kwikr-green">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Campaign Type</label>
                                        <select name="type" required class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-kwikr-green focus:border-kwikr-green">
                                            <option value="">Select Type</option>
                                            <option value="acquisition">User Acquisition</option>
                                            <option value="retention">User Retention</option>
                                            <option value="seasonal">Seasonal Promotion</option>
                                            <option value="brand">Brand Awareness</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Budget ($)</label>
                                        <input type="number" name="budget" required min="0" step="0.01" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-kwikr-green focus:border-kwikr-green">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Target Audience</label>
                                        <select name="target_audience" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-kwikr-green focus:border-kwikr-green">
                                            <option value="all">All Users</option>
                                            <option value="clients">Clients Only</option>
                                            <option value="workers">Service Providers Only</option>
                                            <option value="new_users">New Users</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Start Date</label>
                                        <input type="date" name="start_date" required class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-kwikr-green focus:border-kwikr-green">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">End Date</label>
                                        <input type="date" name="end_date" required class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-kwikr-green focus:border-kwikr-green">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Description</label>
                                    <textarea name="description" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-kwikr-green focus:border-kwikr-green" placeholder="Campaign description and objectives..."></textarea>
                                </div>
                                <div class="flex justify-end space-x-3 pt-4">
                                    <button type="button" onclick="closeCampaignModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">Cancel</button>
                                    <button type="submit" class="px-4 py-2 bg-kwikr-green text-white rounded-md hover:bg-green-600">Create Campaign</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modal);
            
            document.getElementById('createCampaignForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const campaignData = Object.fromEntries(formData.entries());
                
                try {
                    const response = await adminAPI('/campaigns', 'POST', campaignData);
                    if (response.success) {
                        showNotification('Campaign created successfully!', 'success');
                        closeCampaignModal();
                        loadMarketingCampaigns(); // Refresh the list
                    }
                } catch (error) {
                    console.error('Error creating campaign:', error);
                    showNotification('Error creating campaign', 'error');
                }
            });
        }

        function closeCampaignModal() {
            const modal = document.getElementById('campaignModal');
            if (modal) {
                modal.remove();
            }
        }

        async function showCampaignAnalytics() {
            try {
                const response = await adminAPI('/campaigns/analytics');
                if (response.success) {
                    displayCampaignAnalytics(response.data);
                }
            } catch (error) {
                console.error('Error loading campaign analytics:', error);
                showNotification('Error loading analytics', 'error');
            }
        }

        function displayCampaignAnalytics(analytics) {
            const modal = `
                <div id="analyticsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
                    <div class="relative top-10 mx-auto p-5 border w-11/12 md:w-5/6 lg:w-4/5 shadow-lg rounded-md bg-white">
                        <div class="mt-3">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-medium text-gray-900">Campaign Analytics</h3>
                                <button onclick="closeAnalyticsModal()" class="text-gray-400 hover:text-gray-600">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            
                            <!-- Overview Metrics -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h4 class="text-sm font-medium text-blue-700">Total Campaigns</h4>
                                    <p class="text-2xl font-bold text-blue-900">${analytics.overview.total_campaigns}</p>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <h4 class="text-sm font-medium text-green-700">Active Campaigns</h4>
                                    <p class="text-2xl font-bold text-green-900">${analytics.overview.active_campaigns}</p>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <h4 class="text-sm font-medium text-purple-700">Total Conversions</h4>
                                    <p class="text-2xl font-bold text-purple-900">${analytics.overview.total_conversions}</p>
                                </div>
                                <div class="bg-yellow-50 p-4 rounded-lg">
                                    <h4 class="text-sm font-medium text-yellow-700">Avg Conversion Rate</h4>
                                    <p class="text-2xl font-bold text-yellow-900">${analytics.overview.avg_conversion_rate}%</p>
                                </div>
                            </div>
                            
                            <!-- Performance Chart -->
                            <div class="bg-white p-6 rounded-lg border mb-6">
                                <h4 class="text-lg font-semibold mb-4">Campaign Performance Over Time</h4>
                                <canvas id="performanceChart" width="400" height="200"></canvas>
                            </div>
                            
                            <!-- Top Campaigns -->
                            <div class="bg-white p-6 rounded-lg border">
                                <h4 class="text-lg font-semibold mb-4">Top Performing Campaigns</h4>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Campaign</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Conversions</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ROI</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-200">
                                            ${analytics.top_campaigns.map(campaign => `
                                                <tr>
                                                    <td class="px-6 py-4 whitespace-nowrap font-medium">${campaign.name}</td>
                                                    <td class="px-6 py-4 whitespace-nowrap">${campaign.conversions}</td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-green-600 font-semibold">${campaign.roi}x</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modal);
            
            // Create performance chart
            setTimeout(() => {
                const ctx = document.getElementById('performanceChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: analytics.performance.map(p => p.month),
                        datasets: [{
                            label: 'Conversions',
                            data: analytics.performance.map(p => p.conversions),
                            borderColor: '#00C881',
                            backgroundColor: 'rgba(0, 200, 129, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Revenue ($)',
                            data: analytics.performance.map(p => p.revenue),
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: { display: true, text: 'Conversions' }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: { display: true, text: 'Revenue ($)' },
                                grid: { drawOnChartArea: false }
                            }
                        }
                    }
                });
            }, 100);
        }

        function closeAnalyticsModal() {
            const modal = document.getElementById('analyticsModal');
            if (modal) {
                modal.remove();
            }
        }

        async function loadReferralProgram() {
            try {
                // Clear campaigns content when loading referral program
                document.getElementById('campaignsTable').innerHTML = '';
                
                const response = await adminAPI('/referrals');
                if (response.success) {
                    displayReferralProgram(response.data);
                }
            } catch (error) {
                console.error('Error loading referral program:', error);
                showNotification('Error loading referral program', 'error');
            }
        }

        function displayReferralProgram(data) {
            const container = document.getElementById('growthToolsContent');
            container.innerHTML = `
                <div class="space-y-6">
                    <!-- Program Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="text-sm font-medium text-blue-700">Total Referrals</h4>
                            <p class="text-2xl font-bold text-blue-900">${data.program_stats.total_referrals}</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="text-sm font-medium text-green-700">Successful</h4>
                            <p class="text-2xl font-bold text-green-900">${data.program_stats.successful_referrals}</p>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <h4 class="text-sm font-medium text-yellow-700">Pending</h4>
                            <p class="text-2xl font-bold text-yellow-900">${data.program_stats.pending_referrals}</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <h4 class="text-sm font-medium text-purple-700">Rewards Paid</h4>
                            <p class="text-2xl font-bold text-purple-900">$${data.program_stats.total_rewards_paid}</p>
                        </div>
                        <div class="bg-indigo-50 p-4 rounded-lg">
                            <h4 class="text-sm font-medium text-indigo-700">Conversion Rate</h4>
                            <p class="text-2xl font-bold text-indigo-900">${data.program_stats.conversion_rate}%</p>
                        </div>
                    </div>

                    <!-- Recent Referrals -->
                    <div class="bg-white border rounded-lg">
                        <div class="px-6 py-4 border-b">
                            <h4 class="text-lg font-semibold">Recent Referrals</h4>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Referrer</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Referee</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Reward</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    ${data.recent_referrals.map(referral => `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="font-medium">${referral.referrer_name}</div>
                                                <div class="text-sm text-gray-500">${referral.referrer_email}</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="font-medium">${referral.referee_name}</div>
                                                <div class="text-sm text-gray-500">${referral.referee_email}</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs font-semibold rounded-full ${referral.status === 'completed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                                    ${referral.status}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap font-medium">$${referral.reward_amount}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${referral.created_at}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Program Settings -->
                    <div class="bg-white border rounded-lg p-6">
                        <h4 class="text-lg font-semibold mb-4">Program Settings</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Referrer Reward</label>
                                <input type="number" value="${data.settings.referrer_reward}" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Referee Reward</label>
                                <input type="number" value="${data.settings.referee_reward}" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Min Payout</label>
                                <input type="number" value="${data.settings.min_payout_amount}" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Program Status</label>
                                <select class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                    <option value="true" ${data.settings.program_active ? 'selected' : ''}>Active</option>
                                    <option value="false" ${!data.settings.program_active ? 'selected' : ''}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-4">
                            <button class="bg-kwikr-green text-white px-6 py-2 rounded-md hover:bg-green-600">Update Settings</button>
                        </div>
                    </div>
                </div>
            `;
        }

        async function showPromoCodeManager() {
            try {
                // Clear campaigns content when loading promo codes
                document.getElementById('campaignsTable').innerHTML = '';
                
                const response = await adminAPI('/promo-codes');
                if (response.success) {
                    displayPromoCodeManager(response.data);
                }
            } catch (error) {
                console.error('Error loading promo codes', error);
                showNotification('Error loading promo codes', 'error');
            }
        }

        function displayPromoCodeManager(promoCodes) {
            const container = document.getElementById('growthToolsContent');
            container.innerHTML = `
                <div class="space-y-6">
                    <!-- Create Promo Code Button -->
                    <div class="flex justify-between items-center">
                        <h4 class="text-lg font-semibold">Promo Code Management</h4>
                        <button onclick="showCreatePromoCodeForm()" class="bg-kwikr-green text-white px-4 py-2 rounded-lg hover:bg-green-600">
                            <i class="fas fa-plus mr-2"></i>Create Promo Code
                        </button>
                    </div>

                    <!-- Promo Codes Table -->
                    <div class="bg-white border rounded-lg overflow-hidden">
                        <table class="min-w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Code</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Value</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Usage</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Expires</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${promoCodes.map(code => `
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="font-medium text-gray-900">${code.code}</div>
                                            <div class="text-sm text-gray-500">${code.description}</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 py-1 text-xs font-semibold rounded-full ${code.type === 'percentage' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'}">
                                                ${code.type}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap font-medium">
                                            ${code.type === 'percentage' ? code.value + '%' : '$' + code.value}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm">${code.used_count} / ${code.usage_limit}</div>
                                            <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                                <div class="bg-kwikr-green h-2 rounded-full" style="width: ${(code.used_count / code.usage_limit) * 100}%"></div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 py-1 text-xs font-semibold rounded-full ${getStatusColor(code.status)}">
                                                ${code.status}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${code.expires_at}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button onclick="editPromoCode(${code.id})" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</button>
                                            <button onclick="deactivatePromoCode(${code.id})" class="text-red-600 hover:text-red-900">Deactivate</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function showCreatePromoCodeForm() {
            const modal = `
                <div id="promoCodeModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
                    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-md bg-white">
                        <div class="mt-3">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Create New Promo Code</h3>
                            <form id="createPromoCodeForm" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Promo Code</label>
                                        <input type="text" name="code" required placeholder="e.g., WELCOME25" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-kwikr-green focus:border-kwikr-green uppercase">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Discount Type</label>
                                        <select name="type" required class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-kwikr-green focus:border-kwikr-green">
                                            <option value="">Select Type</option>
                                            <option value="percentage">Percentage (%)</option>
                                            <option value="fixed">Fixed Amount ($)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Discount Value</label>
                                        <input type="number" name="value" required min="0" step="0.01" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-kwikr-green focus:border-kwikr-green">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Usage Limit</label>
                                        <input type="number" name="usage_limit" min="1" placeholder="100" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-kwikr-green focus:border-kwikr-green">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700">Expires At</label>
                                        <input type="date" name="expires_at" required class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-kwikr-green focus:border-kwikr-green">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Description</label>
                                    <input type="text" name="description" placeholder="Brief description of the promo code" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-kwikr-green focus:border-kwikr-green">
                                </div>
                                <div class="flex justify-end space-x-3 pt-4">
                                    <button type="button" onclick="closePromoCodeModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">Cancel</button>
                                    <button type="submit" class="px-4 py-2 bg-kwikr-green text-white rounded-md hover:bg-green-600">Create Promo Code</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modal);
            
            document.getElementById('createPromoCodeForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const promoData = Object.fromEntries(formData.entries());
                
                try {
                    const response = await adminAPI('/promo-codes', 'POST', promoData);
                    if (response.success) {
                        showNotification('Promo code created successfully!', 'success');
                        closePromoCodeModal();
                        showPromoCodeManager(); // Refresh the list
                    }
                } catch (error) {
                    console.error('Error creating promo code:', error);
                    showNotification('Error creating promo code', 'error');
                }
            });
        }

        function closePromoCodeModal() {
            const modal = document.getElementById('promoCodeModal');
            if (modal) {
                modal.remove();
            }
        }

        async function loadNotificationCenter() {
            try {
                // Clear campaigns content when loading notifications
                document.getElementById('campaignsTable').innerHTML = '';
                
                const response = await adminAPI('/notifications');
                if (response.success) {
                    displayNotificationCenter(response.data);
                }
            } catch (error) {
                console.error('Error loading notifications:', error);
                showNotification('Error loading notifications', 'error');
            }
        }

        function displayNotificationCenter(data) {
            const container = document.getElementById('growthToolsContent');
            container.innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h4 class="text-lg font-semibold">Notification Center</h4>
                        <button onclick="showNotificationSettings()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
                            <i class="fas fa-cog mr-2"></i>Settings
                        </button>
                    </div>

                    <!-- System Notifications -->
                    <div class="bg-white border rounded-lg">
                        <div class="px-6 py-4 border-b">
                            <h4 class="text-lg font-semibold">System Notifications</h4>
                        </div>
                        <div class="divide-y divide-gray-200">
                            ${data.system_notifications.map(notification => `
                                <div class="px-6 py-4 ${notification.status === 'unread' ? 'bg-blue-50' : ''}">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <h5 class="font-medium text-gray-900">${notification.title}</h5>
                                            <p class="text-sm text-gray-600 mt-1">${notification.message}</p>
                                            <p class="text-xs text-gray-400 mt-2">${notification.created_at}</p>
                                        </div>
                                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${notification.status === 'unread' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'}">
                                            ${notification.status}
                                        </span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- User Notifications -->
                    <div class="bg-white border rounded-lg">
                        <div class="px-6 py-4 border-b">
                            <h4 class="text-lg font-semibold">User Notifications</h4>
                        </div>
                        <div class="divide-y divide-gray-200">
                            ${data.user_notifications.map(notification => `
                                <div class="px-6 py-4 ${notification.status === 'unread' ? 'bg-yellow-50' : ''}">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <h5 class="font-medium text-gray-900">${notification.title}</h5>
                                            <p class="text-sm text-gray-600 mt-1">${notification.message}</p>
                                            <p class="text-xs text-gray-400 mt-2">${notification.created_at}</p>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="px-2 py-1 text-xs font-semibold rounded-full ${getNotificationTypeColor(notification.type)}">
                                                ${notification.type}
                                            </span>
                                            <span class="px-2 py-1 text-xs font-semibold rounded-full ${notification.status === 'unread' ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-800'}">
                                                ${notification.status}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function getNotificationTypeColor(type) {
            switch (type) {
                case 'user': return 'bg-blue-100 text-blue-800';
                case 'payment': return 'bg-red-100 text-red-800';
                case 'system': return 'bg-gray-100 text-gray-800';
                case 'alert': return 'bg-orange-100 text-orange-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Notification System
        function showNotification(message, type = 'info') {
            // Remove existing notification if any
            const existing = document.getElementById('notification');
            if (existing) {
                existing.remove();
            }
            
            const colors = {
                'success': 'bg-green-500',
                'error': 'bg-red-500', 
                'warning': 'bg-yellow-500',
                'info': 'bg-blue-500'
            };
            
            const notification = document.createElement('div');
            notification.id = 'notification';
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification && notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // Helper functions
        function editCampaign(id) { showNotification(`Edit campaign ${id} - functionality coming soon`, 'info'); }
        function viewCampaignDetails(id) { showNotification(`View campaign ${id} details - functionality coming soon`, 'info'); }
        function editPromoCode(id) { showNotification(`Edit promo code ${id} - functionality coming soon`, 'info'); }
        function deactivatePromoCode(id) { showNotification(`Deactivate promo code ${id} - functionality coming soon`, 'info'); }
        function loadSecurityLogs() { 
            // Display mock security logs data
            const container = document.getElementById('securityMonitoringContent');
            container.innerHTML = `
                <div class="space-y-4">
                    <h4 class="text-lg font-semibold">Recent Security Events</h4>
                    <div class="bg-white border border-gray-200 rounded-lg">
                        <div class="px-4 py-3 border-b border-gray-200 bg-gray-50">
                            <h5 class="font-medium">Security Activity Log</h5>
                        </div>
                        <div class="divide-y divide-gray-200">
                            <div class="px-4 py-3 flex justify-between items-center">
                                <div>
                                    <p class="font-medium text-gray-900">Admin Login</p>
                                    <p class="text-sm text-gray-500">admin@kwikr.ca logged in from IP 192.168.1.100</p>
                                    <p class="text-xs text-gray-400">2024-09-07 20:15:00</p>
                                </div>
                                <span class="bg-green-100 text-green-800 px-2 py-1 text-xs rounded-full">Success</span>
                            </div>
                            <div class="px-4 py-3 flex justify-between items-center">
                                <div>
                                    <p class="font-medium text-gray-900">Failed Login Attempt</p>
                                    <p class="text-sm text-gray-500">Multiple failed attempts from IP 203.0.113.42</p>
                                    <p class="text-xs text-gray-400">2024-09-07 19:45:00</p>
                                </div>
                                <span class="bg-red-100 text-red-800 px-2 py-1 text-xs rounded-full">Failed</span>
                            </div>
                            <div class="px-4 py-3 flex justify-between items-center">
                                <div>
                                    <p class="font-medium text-gray-900">API Rate Limit</p>
                                    <p class="text-sm text-gray-500">Rate limit exceeded for API key abc123</p>
                                    <p class="text-xs text-gray-400">2024-09-07 18:30:00</p>
                                </div>
                                <span class="bg-yellow-100 text-yellow-800 px-2 py-1 text-xs rounded-full">Warning</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        function showFailedLogins() { 
            const container = document.getElementById('securityMonitoringContent');
            container.innerHTML = `
                <div class="space-y-4">
                    <h4 class="text-lg font-semibold text-red-600">Failed Login Attempts</h4>
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="font-medium text-red-800">IP: 203.0.113.42</p>
                                    <p class="text-sm text-red-600">5 attempts in last hour</p>
                                    <p class="text-xs text-red-500">Last attempt: 2024-09-07 20:10:00</p>
                                </div>
                                <button class="bg-red-600 text-white px-3 py-1 text-sm rounded hover:bg-red-700">
                                    Block IP
                                </button>
                            </div>
                            <hr class="border-red-200">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="font-medium text-red-800">IP: 192.0.2.100</p>
                                    <p class="text-sm text-red-600">3 attempts in last 2 hours</p>
                                    <p class="text-xs text-red-500">Last attempt: 2024-09-07 18:45:00</p>
                                </div>
                                <button class="bg-yellow-600 text-white px-3 py-1 text-sm rounded hover:bg-yellow-700">
                                    Monitor
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        function loadSuspiciousActivities() { 
            const container = document.getElementById('securityMonitoringContent');
            container.innerHTML = `
                <div class="space-y-4">
                    <h4 class="text-lg font-semibold text-orange-600">Suspicious Activities</h4>
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="font-medium text-orange-800">Unusual Job Posting Pattern</p>
                                    <p class="text-sm text-orange-600">User ID 245 posted 15 jobs in 1 hour</p>
                                    <p class="text-xs text-orange-500">Detected: 2024-09-07 19:30:00</p>
                                </div>
                                <button class="bg-orange-600 text-white px-3 py-1 text-sm rounded hover:bg-orange-700">
                                    Review
                                </button>
                            </div>
                            <hr class="border-orange-200">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="font-medium text-orange-800">Multiple Account Creation</p>
                                    <p class="text-sm text-orange-600">Same IP created 8 accounts today</p>
                                    <p class="text-xs text-orange-500">IP: 198.51.100.25</p>
                                </div>
                                <button class="bg-red-600 text-white px-3 py-1 text-sm rounded hover:bg-red-700">
                                    Flag
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        function generateComplianceReport(type) { 
            const container = document.getElementById('complianceReportsContent');
            const reportTitles = {
                'privacy': 'Privacy Compliance Report',
                'data': 'Data Protection Report', 
                'audit': 'Security Audit Report'
            };
            
            container.innerHTML = `
                <div class="space-y-4">
                    <h4 class="text-lg font-semibold">${reportTitles[type]}</h4>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-blue-800">Report Status:</span>
                                <span class="bg-green-100 text-green-800 px-2 py-1 text-xs rounded-full">Generated</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-blue-800">Generated:</span>
                                <span class="text-sm text-blue-600">${new Date().toLocaleString()}</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-blue-800">Compliance Score:</span>
                                <span class="text-sm text-green-600 font-bold">94%</span>
                            </div>
                            <div class="mt-4 pt-3 border-t border-blue-200">
                                <button class="bg-blue-600 text-white px-4 py-2 text-sm rounded hover:bg-blue-700 mr-2">
                                    Download PDF
                                </button>
                                <button class="bg-gray-600 text-white px-4 py-2 text-sm rounded hover:bg-gray-700">
                                    Email Report
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        function reviewContent(id) { 
            showNotification(`Reviewing content ID ${id} - Content approved for publication`, 'success'); 
            // Remove the item from the moderation queue UI
            const itemElement = document.querySelector(`[data-moderation-id="${id}"]`);
            if (itemElement) {
                itemElement.remove();
            }
        }
        function dismissReport(id) { 
            showNotification(`Report ID ${id} dismissed - No action taken`, 'info'); 
            // Remove the item from the moderation queue UI
            const itemElement = document.querySelector(`[data-moderation-id="${id}"]`);
            if (itemElement) {
                itemElement.remove();
            }
        }
        function viewAdminActivity(id) { showNotification('Admin activity log functionality available in next update', 'info'); }
        function editAdmin(id) { showNotification('Edit Admin functionality available in next update', 'info'); }
        
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '/auth/login';
            }
        }
    </script>
</body>
</html>