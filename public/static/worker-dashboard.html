<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worker Dashboard - Kwikr</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'kwikr-green': '#00C881',
              'kwikr-dark': '#1a1a1a',
              'kwikr-gray': '#f8f9fa'
            }
          }
        }
      }
    </script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="/" class="text-2xl font-bold text-kwikr-green hover:text-green-600">
                        <img src="/static/kwikr-logo.svg" alt="Kwikr" class="h-8 w-8 mr-2 inline-block">Kwikr
                    </a>
                    <span class="ml-4 text-gray-400">|</span>
                    <h1 class="ml-4 text-xl font-semibold text-gray-700">Worker Dashboard</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-bell text-lg"></i>
                    </button>
                    <button class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-user-circle text-lg"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Dashboard Header -->
        <div class="mb-8">
            <div class="bg-gradient-to-r from-kwikr-green to-green-600 rounded-lg shadow-lg text-white p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold mb-2">Welcome back, Professional!</h2>
                        <p class="text-green-100">Here's your dashboard overview for this week</p>
                    </div>
                    <div class="text-right">
                        <div class="text-3xl font-bold">$2,450</div>
                        <div class="text-green-100 text-sm">This Week's Earnings</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Active Applications -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-clipboard-list text-blue-600"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Active Applications</p>
                        <p class="text-2xl font-semibold text-gray-900" id="activeApplications">5</p>
                    </div>
                </div>
                <div class="mt-4">
                    <span class="text-green-600 text-sm font-medium">+12% from last week</span>
                </div>
            </div>

            <!-- Total Earnings -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-dollar-sign text-kwikr-green"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Monthly Earnings</p>
                        <p class="text-2xl font-semibold text-gray-900" id="monthlyEarnings">$8,750</p>
                    </div>
                </div>
                <div class="mt-4">
                    <span class="text-green-600 text-sm font-medium">+8% from last month</span>
                </div>
            </div>

            <!-- Active Customers -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-users text-purple-600"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Active Customers</p>
                        <p class="text-2xl font-semibold text-gray-900" id="activeCustomers">23</p>
                    </div>
                </div>
                <div class="mt-4">
                    <span class="text-green-600 text-sm font-medium">+3 new this week</span>
                </div>
            </div>

            <!-- Average Rating -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-star text-yellow-600"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Average Rating</p>
                        <p class="text-2xl font-semibold text-gray-900" id="averageRating">4.8</p>
                    </div>
                </div>
                <div class="mt-4">
                    <span class="text-green-600 text-sm font-medium">98% satisfaction rate</span>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column - Primary Features -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- Job Applications Tracking -->
                <div class="bg-white rounded-lg shadow-sm">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900">
                                <i class="fas fa-clipboard-list text-blue-600 mr-2"></i>
                                Job Applications Tracking
                            </h3>
                            <button onclick="viewAllApplications()" class="text-blue-600 hover:text-blue-800 text-sm font-medium">View All</button>
                        </div>
                    </div>
                    <div class="p-6">
                        <div id="jobApplications" class="space-y-4">
                            <!-- Applications will be loaded here -->
                        </div>
                        <div class="mt-4 text-center">
                            <button onclick="findNewJobs()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-search mr-2"></i>Find New Jobs
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Earnings Dashboard -->
                <div class="bg-white rounded-lg shadow-sm">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900">
                                <i class="fas fa-chart-line text-kwikr-green mr-2"></i>
                                Earnings Analytics
                            </h3>
                            <select class="text-sm border rounded-md px-3 py-1">
                                <option>Last 30 Days</option>
                                <option>Last 3 Months</option>
                                <option>This Year</option>
                            </select>
                        </div>
                    </div>
                    <div class="p-6">
                        <canvas id="earningsChart" width="400" height="200"></canvas>
                    </div>
                </div>

                <!-- Customer Management -->
                <div class="bg-white rounded-lg shadow-sm">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900">
                                <i class="fas fa-handshake text-purple-600 mr-2"></i>
                                Customer Relationships
                            </h3>
                            <button onclick="manageAllCustomers()" class="text-purple-600 hover:text-purple-800 text-sm font-medium">Manage All</button>
                        </div>
                    </div>
                    <div class="p-6">
                        <div id="customersList" class="space-y-4">
                            <!-- Customers will be loaded here -->
                        </div>
                    </div>
                </div>

            </div>

            <!-- Right Column - Secondary Features -->
            <div class="space-y-8">
                
                <!-- Service Analytics -->
                <div class="bg-white rounded-lg shadow-sm">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900">
                            <i class="fas fa-analytics text-indigo-600 mr-2"></i>
                            Service Performance
                        </h3>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4">
                            <!-- Service metrics -->
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600">Jobs Completed</span>
                                <span class="font-semibold">147</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600">Response Time</span>
                                <span class="font-semibold text-green-600">2.3 hrs</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600">Success Rate</span>
                                <span class="font-semibold text-green-600">98.5%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Availability Management -->
                <div class="bg-white rounded-lg shadow-sm">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900">
                                <i class="fas fa-calendar text-orange-600 mr-2"></i>
                                Availability
                            </h3>
                            <button onclick="editSchedule()" class="text-orange-600 hover:text-orange-800 text-sm font-medium">Edit Schedule</button>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600">Today</span>
                                <span class="text-green-600 font-medium">Available</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600">Tomorrow</span>
                                <span class="text-green-600 font-medium">9 AM - 6 PM</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600">This Week</span>
                                <span class="text-gray-500">32 hours available</span>
                            </div>
                        </div>
                        <button onclick="updateAvailability()" class="w-full mt-4 bg-orange-600 text-white py-2 px-4 rounded-lg hover:bg-orange-700 transition-colors">
                            <i class="fas fa-clock mr-2"></i>Update Availability
                        </button>
                    </div>
                </div>

                <!-- Portfolio Management -->
                <div class="bg-white rounded-lg shadow-sm">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900">
                                <i class="fas fa-briefcase text-teal-600 mr-2"></i>
                                Portfolio
                            </h3>
                            <button onclick="addWork()" class="text-teal-600 hover:text-teal-800 text-sm font-medium">Add Work</button>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-2 gap-3">
                            <div class="aspect-square bg-gray-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-image text-gray-400 text-2xl"></i>
                            </div>
                            <div class="aspect-square bg-gray-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-image text-gray-400 text-2xl"></i>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-3">Showcase your best work</p>
                        <button onclick="uploadSample()" class="w-full mt-3 border border-teal-600 text-teal-600 py-2 px-4 rounded-lg hover:bg-teal-50 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Upload Sample
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <!-- Performance Goals -->
        <div class="mt-8">
            <div class="bg-white rounded-lg shadow-sm">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">
                            <i class="fas fa-target text-red-600 mr-2"></i>
                            Performance Goals
                        </h3>
                        <button onclick="setNewGoal()" class="text-red-600 hover:text-red-800 text-sm font-medium">Set New Goal</button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Monthly Earnings Goal -->
                        <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-medium text-gray-900">Monthly Earnings</h4>
                                <i class="fas fa-dollar-sign text-green-600"></i>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">$8,750 / $10,000</span>
                                    <span class="font-medium text-green-600">87.5%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-600 h-2 rounded-full" style="width: 87.5%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Jobs Completed Goal -->
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-medium text-gray-900">Jobs This Month</h4>
                                <i class="fas fa-tasks text-blue-600"></i>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">24 / 30 jobs</span>
                                    <span class="font-medium text-blue-600">80%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: 80%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Rating Goal -->
                        <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-medium text-gray-900">Maintain Rating</h4>
                                <i class="fas fa-star text-yellow-600"></i>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">4.8 / 4.5 stars</span>
                                    <span class="font-medium text-green-600">Achieved!</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-600 h-2 rounded-full" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            initializeCharts();
            loadJobApplications();
            loadCustomers();
        });

        // Load dashboard data from API
        async function loadDashboardData() {
            try {
                // In a real implementation, replace with actual worker ID
                const workerId = 1;
                const response = await axios.get(`/api/worker-dashboard/summary/${workerId}`);
                
                if (response.data) {
                    updateDashboardStats(response.data);
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                // Use mock data for demo
                updateDashboardStats(getMockDashboardData());
            }
        }

        function updateDashboardStats(data) {
            // Update stats with real or mock data
            document.getElementById('activeApplications').textContent = data.activeApplications || 5;
            document.getElementById('monthlyEarnings').textContent = '$' + (data.monthlyEarnings || 8750).toLocaleString();
            document.getElementById('activeCustomers').textContent = data.activeCustomers || 23;
            document.getElementById('averageRating').textContent = data.averageRating || 4.8;
        }

        function getMockDashboardData() {
            return {
                activeApplications: 5,
                monthlyEarnings: 8750,
                activeCustomers: 23,
                averageRating: 4.8,
                weeklyEarnings: 2450
            };
        }

        // Initialize earnings chart
        function initializeCharts() {
            const ctx = document.getElementById('earningsChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Weekly Earnings',
                        data: [2100, 2350, 2200, 2450],
                        borderColor: '#00C881',
                        backgroundColor: 'rgba(0, 200, 129, 0.1)',
                        borderWidth: 3,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // Load job applications
        async function loadJobApplications() {
            try {
                const workerId = 1;
                const response = await axios.get(`/api/worker-dashboard/applications/${workerId}`);
                displayJobApplications(response.data);
            } catch (error) {
                console.error('Error loading job applications:', error);
                displayJobApplications(getMockJobApplications());
            }
        }

        function displayJobApplications(applications) {
            const container = document.getElementById('jobApplications');
            if (applications.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-clipboard-list text-4xl mb-4"></i>
                        <p>No active job applications</p>
                        <button class="mt-3 text-blue-600 hover:text-blue-800 font-medium">
                            Browse Available Jobs
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = applications.map(app => `
                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-medium text-gray-900">${app.job_title || 'Job Application'}</h4>
                            <p class="text-sm text-gray-500">${app.job_description || 'Professional service opportunity'}</p>
                            <div class="mt-2">
                                <span class="text-xs px-2 py-1 rounded-full ${getStatusColor(app.application_status)}">
                                    ${formatStatus(app.application_status)}
                                </span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-semibold text-kwikr-green">$${app.bid_amount || 150}/hr</div>
                            <div class="text-xs text-gray-500">${formatDate(app.applied_at)}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getMockJobApplications() {
            return [
                {
                    job_title: 'Office Deep Cleaning',
                    job_description: 'Weekly office cleaning for law firm',
                    application_status: 'under_review',
                    bid_amount: 45,
                    applied_at: new Date().toISOString()
                },
                {
                    job_title: 'Residential Cleaning',
                    job_description: 'Bi-weekly home cleaning service',
                    application_status: 'shortlisted',
                    bid_amount: 35,
                    applied_at: new Date(Date.now() - 86400000).toISOString()
                }
            ];
        }

        // Load customers
        async function loadCustomers() {
            try {
                const workerId = 1;
                const response = await axios.get(`/api/worker-dashboard/customers/${workerId}`);
                displayCustomers(response.data);
            } catch (error) {
                console.error('Error loading customers:', error);
                displayCustomers(getMockCustomers());
            }
        }

        function displayCustomers(customers) {
            const container = document.getElementById('customersList');
            if (customers.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-6 text-gray-500">
                        <i class="fas fa-users text-3xl mb-3"></i>
                        <p>No customers yet</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = customers.slice(0, 3).map(customer => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center">
                            <span class="text-purple-600 font-medium">${getInitials(customer.client_name || 'Client')}</span>
                        </div>
                        <div class="ml-3">
                            <p class="font-medium text-gray-900">${customer.client_name || 'Valued Client'}</p>
                            <p class="text-sm text-gray-500">${customer.total_jobs_completed || 3} jobs • $${customer.total_earnings || 1250} earned</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-yellow-500">
                            ${Array(Math.floor(customer.average_rating || 5)).fill('★').join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getMockCustomers() {
            return [
                {
                    client_name: 'Sarah Johnson',
                    total_jobs_completed: 8,
                    total_earnings: 2400,
                    average_rating: 5
                },
                {
                    client_name: 'Mike Chen',
                    total_jobs_completed: 5,
                    total_earnings: 1750,
                    average_rating: 4.8
                },
                {
                    client_name: 'Emily Davis',
                    total_jobs_completed: 3,
                    total_earnings: 1050,
                    average_rating: 5
                }
            ];
        }

        // Utility functions
        function getStatusColor(status) {
            const colors = {
                'applied': 'bg-blue-100 text-blue-800',
                'under_review': 'bg-yellow-100 text-yellow-800',
                'shortlisted': 'bg-green-100 text-green-800',
                'accepted': 'bg-green-100 text-green-800',
                'rejected': 'bg-red-100 text-red-800',
                'withdrawn': 'bg-gray-100 text-gray-800'
            };
            return colors[status] || 'bg-gray-100 text-gray-800';
        }

        function formatStatus(status) {
            return status.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString();
        }

        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        }

        // Button functionality
        function viewAllApplications() {
            alert('View All Applications - This feature will show all your job applications in a detailed view.');
        }

        function findNewJobs() {
            alert('Find New Jobs - This feature will take you to the job search page where you can browse available opportunities.');
        }

        function manageAllCustomers() {
            alert('Manage All Customers - This feature will show your customer relationship management dashboard.');
        }

        function editSchedule() {
            alert('Edit Schedule - This feature will open a calendar interface to modify your availability schedule.');
        }

        function updateAvailability() {
            alert('Update Availability - This feature will allow you to quickly update your current availability status.');
        }

        function addWork() {
            alert('Add Work - This feature will allow you to add new work samples to your portfolio.');
        }

        function uploadSample() {
            alert('Upload Sample - This feature will open a file upload dialog for portfolio samples.');
        }

        function setNewGoal() {
            alert('Set New Goal - This feature will allow you to set performance targets and goals.');
        }
    </script>
</body>
</html>